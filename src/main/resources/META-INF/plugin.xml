<idea-plugin>
    <id>pl.thedeem.intellij.dql</id>
    <name>Dynatrace Query Language</name>
    <vendor url="https://www.dynatrace.com">(unofficial) Dynatrace</vendor>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.java</depends>
    <depends>com.intellij.modules.json</depends>

    <extensions defaultExtensionNs="com.intellij">
        <fileType
                name="DQL"
                implementationClass="pl.thedeem.intellij.dql.DQLFileType"
                fieldName="INSTANCE"
                language="DQL"
                extensions="dql"/>
        <lang.parserDefinition
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.DQLParserDefinition"/>

        <!-- Syntax -->
        <lang.syntaxHighlighterFactory
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.highlighting.DQLSyntaxHighlighterFactory"/>
        <colorSettingsPage
                implementation="pl.thedeem.intellij.dql.highlighting.DQLColorSettingsPage"/>
        <annotator
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.annotator.DQLAnnotator"/>
        <lang.foldingBuilder
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.code.DQLFoldingBuilder"/>
        <lang.commenter
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.code.DQLCommenter"/>
        <lang.braceMatcher language="DQL"
                           implementationClass="pl.thedeem.intellij.dql.code.DQLPairedBraceMatcher"/>
        <quoteHandler className="pl.thedeem.intellij.dql.code.DQLQuoteHandler" fileType="DQL"/>
        <codeInsight.parameterNameHints language="DQL"
                                        implementationClass="pl.thedeem.intellij.dql.highlighting.DQLInlayParameterHintsProvider"/>
        <multiHostInjector
                implementation="pl.thedeem.intellij.dql.highlighting.DQLJsonInjectorContributor"/>

        <!-- Docs -->
        <lang.documentationProvider
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.documentation.DQLDocumentationProvider"/>

        <!-- References -->
        <psi.referenceContributor
                language="DQL"
                implementation="pl.thedeem.intellij.dql.indexing.DQLReferenceContributor"/>
        <lang.refactoringSupport
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.indexing.DQLRefactoringSupportProvider"/>
        <lang.findUsagesProvider
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.indexing.DQLFindUsagesProvider"/>
        <usageTypeProvider implementation="pl.thedeem.intellij.dql.indexing.DQLUsageTypeProvider"/>
        <lang.elementManipulator
                forClass="pl.thedeem.intellij.dql.psi.elements.FieldElement"
                implementationClass="pl.thedeem.intellij.dql.indexing.DQLFieldElementManipulator"/>
        <lang.elementManipulator
                forClass="pl.thedeem.intellij.dql.psi.elements.VariableElement"
                implementationClass="pl.thedeem.intellij.dql.indexing.DQLVariableElementManipulator"/>
        <renameInputValidator implementation="pl.thedeem.intellij.dql.indexing.DQLRenameInputValidator"/>
        <renamePsiElementProcessor implementation="pl.thedeem.intellij.dql.indexing.DQLRenamePsiElementProcessor"/>
        <gotoSymbolContributor
                implementation="pl.thedeem.intellij.dql.indexing.DQLChooseByNameContributor"/>

        <!-- Completions -->
        <completion.contributor
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.completion.DQLLocalCompletionContributor"/>
        <completion.contributor order="last"
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.completion.DQLExternalCompletionContributor"/>

        <!-- Styling -->
        <lang.formatter
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.style.DQLFormattingModelBuilder"/>
        <codeStyleSettingsProvider
                implementation="pl.thedeem.intellij.dql.style.DQLCodeStyleSettingsProvider"/>
        <langCodeStyleSettingsProvider
                implementation="pl.thedeem.intellij.dql.style.DQLLanguageCodeStyleSettingsProvider"/>

        <!-- Structure -->
        <lang.psiStructureViewFactory
                language="DQL"
                implementationClass="pl.thedeem.intellij.dql.structure.DQLStructureViewFactory"/>
        <navbar implementation="pl.thedeem.intellij.dql.structure.DQLStructureAwareNavbar"/>

        <!-- Validations -->
        <spellchecker.support language="DQL"
                              implementationClass="pl.thedeem.intellij.dql.code.DQLSpellcheckingStrategy"/>
        <!-- Expression validations -->
        <localInspection language="DQL" shortName="InvalidTimeAlignmentDuration" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.time.alignment.operand.type.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidTimeAlignmentDurationInspection"/>
        <localInspection language="DQL" shortName="InvalidTimeAlignmentTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.time.alignment.operator.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidTimeAlignmentTargetInspection"/>
        <localInspection language="DQL" shortName="EmptySubquery" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.subquery.body.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.EmptySubqueryInspection"/>
        <localInspection language="DQL" shortName="EmptyBrackets" enabledByDefault="true" level="INFO"
                         groupKey="inspection.groups.dql" key="inspection.bracket.body.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.EmptyBracketsInspection"/>
        <localInspection language="DQL" shortName="SortingKeyword" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.sortingKeyword.usage.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.SortingKeywordInspection"/>
        <localInspection language="DQL" shortName="InvalidSortingOperation" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.sorting.invalidTarget.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidSortingOperationInspection"/>
        <localInspection language="DQL" shortName="InvalidFieldReadOperation" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.fieldReadOperation.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidFieldReadOperationInspection"/>
        <localInspection language="DQL" shortName="InvalidFieldWriteOperation" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.fieldWriteOperation.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidFieldWriteOperationInspection"/>
        <localInspection language="DQL" shortName="InvalidNegationTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.negation.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidNegationTargetInspection"/>
        <localInspection language="DQL" shortName="InvalidEqualityTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.equality.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidEqualityTargetInspection"/>
        <localInspection language="DQL" shortName="UnsupportedEqualityType" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.equality.unsupportedType.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.UnsupportedEqualityTypeInspection"/>
        <localInspection language="DQL" shortName="InvalidArithmeticalTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.arithmetical.operation.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidArithmeticalTargetInspection"/>
        <localInspection language="DQL" shortName="UnsupportedArithmeticalType" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.arithmetical.unsupportedType.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.UnsupportedArithmeticalTypeInspection"/>
        <localInspection language="DQL" shortName="InvalidComparisonTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.comparison.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidComparisonTargetInspection"/>
        <localInspection language="DQL" shortName="UnsupportedComparisonType" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.comparison.unsupportedType.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.UnsupportedComparisonTypeInspection"/>
        <localInspection language="DQL" shortName="InvalidConditionTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.condition.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidConditionTargetInspection"/>
        <localInspection language="DQL" shortName="InvalidArrayTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.array.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidArrayTargetInspection"/>
        <localInspection language="DQL" shortName="InvalidAssignTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.assign.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidAssignTargetInspection"/>
        <localInspection language="DQL" shortName="StaticCondition" enabledByDefault="true" level="INFO"
                         groupKey="inspection.groups.dql" key="inspection.condition.static.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.StaticConditionInspection"/>
        <localInspection language="DQL" shortName="StaticComparison" enabledByDefault="true" level="INFO"
                         groupKey="inspection.groups.dql" key="inspection.comparison.static.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.StaticComparisonInspection"/>
        <localInspection language="DQL" shortName="InvalidNegativeValueTarget" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.negativeValue.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.InvalidNegativeValueTargetInspection"/>
        <localInspection language="DQL" shortName="ComplexNegativeValue" enabledByDefault="true" level="INFO"
                         groupKey="inspection.groups.dql" key="inspection.complexNegativeValue.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.ComplexNegativeValueInspection"/>
        <localInspection language="DQL" shortName="RightSideNegativeValue" enabledByDefault="true" level="INFO"
                         groupKey="inspection.groups.dql" key="inspection.rightSideNegativeValue.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.expressions.RightSideNegativeValueInspection"/>
        <!-- Function validations -->
        <localInspection language="DQL" shortName="UnknownFunction" enabledByDefault="true" level="WARNING"
                         groupKey="inspection.groups.dql" key="inspection.function.name.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.functions.UnknownFunctionInspection"/>
        <localInspection language="DQL" shortName="MissingFunctionParameters" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.function.parameters.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.functions.MissingFunctionParametersInspection"/>
        <localInspection language="DQL" shortName="DuplicatedFunctionParameter" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.function.duplicatedParameters.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.functions.DuplicatedFunctionParameterInspection"/>
        <!-- Command validations -->
        <localInspection language="DQL" shortName="UnknownCommand" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.command.name.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.commands.UnknownCommandInspection"/>
        <localInspection language="DQL" shortName="InvalidCommandContext" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.command.context.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.commands.InvalidCommandContextInspection"/>
        <localInspection language="DQL" shortName="MissingCommandParameters" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.command.body.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.commands.MissingCommandParametersInspection"/>
        <localInspection language="DQL" shortName="DuplicatedCommandParameters" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.command.duplicatedParameters.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.commands.DuplicatedCommandParametersInspection"/>
        <localInspection language="DQL" shortName="AdvisedBracketsAroundParameters" enabledByDefault="true" level="INFO"
                         groupKey="inspection.groups.dql" key="inspection.command.advisedBrackets.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.commands.AdvisedBracketsAroundParametersInspection"/>
        <localInspection language="DQL" shortName="DuplicatedFieldNames" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.command.duplicatedFieldNames.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.commands.DuplicatedFieldNamesInspection"/>
        <!-- Parameters validations -->
        <localInspection language="DQL" shortName="ConflictedParameter" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.conflicted.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.ConflictedParameterInspection"/>
        <localInspection language="DQL" shortName="InvalidParameterName" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.invalidName.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.InvalidParameterNameInspection"/>
        <localInspection language="DQL" shortName="UnknownParameter" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.unknown.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.UnknownParameterInspection"/>
        <localInspection language="DQL" shortName="ParameterValue" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.command.parametersValue.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.ParameterValueInspection"/>
        <localInspection language="DQL" shortName="RecordsListParameter" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.recordsList.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.RecordsListParameterInspection"/>
        <localInspection language="DQL" shortName="AggregationFunction" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.aggregationFunction.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.AggregationFunctionParameterInspection"/>
        <localInspection language="DQL" shortName="EnumValueParameter" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.enumValue.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.EnumValueParameterInspection"/>
        <localInspection language="DQL" shortName="ConstantValueParameter" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.constantValue.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.ConstantValueParameterInspection"/>
        <localInspection language="DQL" shortName="JoinConditionParameter" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.parameter.joinCondition.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.parameters.JoinConditionParameterInspection"/>
        <!-- Value validations -->
        <localInspection language="DQL" shortName="SingleQuotesUsage" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.singleQuotes.usage.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.simple.SingleQuotesUsageInspection"/>
        <localInspection language="DQL" shortName="DurationType" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.duration.type.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.simple.DurationTypeInspection"/>
        <localInspection language="DQL" shortName="UnknownVariable" enabledByDefault="true" level="ERROR"
                         groupKey="inspection.groups.dql" key="inspection.variable.unknown.display.name"
                         implementationClass="pl.thedeem.intellij.dql.inspections.simple.UnknownVariableInspection"/>
        <!-- Dynatrace inspections -->
        <externalAnnotator language="DQL" implementationClass="pl.thedeem.intellij.dql.inspections.external.DQLVerificationAnnotator"/>

        <!-- Settings -->
        <applicationService serviceImplementation="pl.thedeem.intellij.dql.settings.DQLSettings"/>

        <applicationConfigurable
                parentId="tools"
                id="DQLSettingsConfigurable"
                instance="pl.thedeem.intellij.dql.settings.DQLSettingsConfigurable"
                key="settings.dql.title"
        />
        <applicationConfigurable
                parentId="DQLSettingsConfigurable"
                id="DQLTenants"
                instance="pl.thedeem.intellij.dql.settings.tenants.DynatraceTenantsConfigurable"
                key="settings.dql.tenants.title"
        />

        <!-- Services -->
        <applicationService serviceImplementation="pl.thedeem.intellij.dql.settings.tenants.DynatraceTenantsService"/>
        <configurationType
                implementation="pl.thedeem.intellij.dql.executing.executeDql.runConfiguration.ExecuteDQLConfigurationType"/>
        <programRunner implementation="pl.thedeem.intellij.dql.executing.DQLProgramRunner"/>
        <serviceViewContributor implementation="pl.thedeem.intellij.dql.executing.services.DQLServiceViewContributor"/>

        <fileEditorProvider implementation="pl.thedeem.intellij.dql.fileProviders.DQLFileEditorProvider"/>
    </extensions>

    <actions resource-bundle="messages.DQLBundle">
        <group id="DQL">
            <action id="DQL.ExecuteScript" class="pl.thedeem.intellij.dql.actions.ExecuteDQLFromEditorAction" icon="AllIcons.Actions.Execute">
                <add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="RunnerActions"/>
                <add-to-group group-id="ProjectViewPopupMenu" anchor="after" relative-to-action="NewGroup"/>
                <keyboard-shortcut keymap="$default"  first-keystroke="control alt E"/>
            </action>
        </group>
        <action id="DQL.NewDQLFile" class="pl.thedeem.intellij.dql.actions.CreateNewDQLFile" icon="/icons/dynatrace.png"/>
    </actions>
    <resource-bundle>messages.DQLBundle</resource-bundle>
</idea-plugin>